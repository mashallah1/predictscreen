<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PredictScreen - Prediction Market Aggregator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    .animate-spin { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
  </style>
</head>
<body class="bg-gray-950 text-white min-h-screen">
  <div id="app"></div>

  <script type="module">
    const { useState, useEffect, useRef } = React;

    function PredictScreen() {
      const [markets, setMarkets] = useState([]);
      const [loading, setLoading] = useState(true);
      const [filter, setFilter] = useState('all');
      const [searchTerm, setSearchTerm] = useState('');
      const [error, setError] = useState(null);
      const [success, setSuccess] = useState(null);
      const [walletConnected, setWalletConnected] = useState(false);
      const [walletAddress, setWalletAddress] = useState('');
      const [alerts, setAlerts] = useState([]);
      const [showAlertsModal, setShowAlertsModal] = useState(false);
      const wsRef = useRef(null);

      const fetchMarkets = async () => {
        setLoading(true);
        try {
          const [polyData, kalshiData] = await Promise.allSettled([
            fetch('https://gamma-api.polymarket.com/events?limit=15&closed=false&order=volume24hr&ascending=false')
              .then(r => r.json()),
            fetch('https://api.elections.kalshi.com/trade-api/v2/markets?limit=10&status=open')
              .then(r => r.json())
          ]);

          const allMarkets = [];

          if (polyData.status === 'fulfilled') {
            polyData.value.forEach(event => {
              const market = event.markets?.[0];
              if (market) {
                const yesPrice = parseFloat(market.outcomePrices?.[0] || 0);
                allMarkets.push({
                  id: `poly-${market.id}`,
                  title: event.title,
                  platform: 'Polymarket',
                  category: event.category || 'Other',
                  probability: Math.round(yesPrice * 100),
                  volume: parseFloat(market.volume || 0),
                  volume24h: parseFloat(market.volume24hr || 0),
                  outcomes: [
                    { name: 'Yes', prob: Math.round(yesPrice * 100) },
                    { name: 'No', prob: Math.round((1 - yesPrice) * 100) }
                  ],
                  url: `https://polymarket.com/event/${event.slug}`
                });
              }
            });
          }

          if (kalshiData.status === 'fulfilled' && kalshiData.value.markets) {
            kalshiData.value.markets.forEach(market => {
              const avgPrice = (parseFloat(market.yes_bid || 0) + parseFloat(market.yes_ask || 0)) / 200;
              allMarkets.push({
                id: `kalshi-${market.ticker}`,
                title: market.title,
                platform: 'Kalshi',
                category: 'Politics',
                probability: Math.round(avgPrice * 100),
                volume: market.volume || 0,
                volume24h: market.volume_24h || 0,
                outcomes: [
                  { name: 'Yes', prob: Math.round(avgPrice * 100) },
                  { name: 'No', prob: 100 - Math.round(avgPrice * 100) }
                ],
                url: `https://kalshi.com/markets/${market.ticker}`
              });
            });
          }

          setMarkets(allMarkets);
        } catch (err) {
          setError('Failed to load markets');
        } finally {
          setLoading(false);
        }
      };

      const connectWallet = async () => {
        try {
          if (typeof window.ethereum !== 'undefined') {
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            setWalletAddress(accounts[0]);
            setWalletConnected(true);
            setSuccess('Wallet connected!');
            setTimeout(() => setSuccess(null), 3000);
          } else {
            setError('Please install MetaMask');
          }
        } catch (err) {
          setError('Failed to connect wallet');
        }
      };

      useEffect(() => {
        fetchMarkets();
        const interval = setInterval(fetchMarkets, 30000);
        return () => clearInterval(interval);
      }, []);

      const formatVolume = (vol) => {
        if (vol >= 1e9) return `$${(vol / 1e9).toFixed(2)}B`;
        if (vol >= 1e6) return `$${(vol / 1e6).toFixed(1)}M`;
        if (vol >= 1e3) return `$${(vol / 1e3).toFixed(0)}K`;
        return `$${vol}`;
      };

      const filteredMarkets = markets
        .filter(m => filter === 'all' || m.category.toLowerCase() === filter.toLowerCase())
        .filter(m => searchTerm === '' || m.title.toLowerCase().includes(searchTerm.toLowerCase()));

      return React.createElement('div', { className: 'min-h-screen' },
        // Header
        React.createElement('div', { className: 'border-b border-gray-800 bg-gray-900/50 backdrop-blur-xl sticky top-0 z-50' },
          React.createElement('div', { className: 'max-w-7xl mx-auto px-4 py-4' },
            React.createElement('div', { className: 'flex items-center justify-between mb-4' },
              React.createElement('div', { className: 'flex items-center gap-3' },
                React.createElement('div', { className: 'bg-gradient-to-br from-blue-500 to-purple-600 p-2 rounded-lg text-2xl' }, 'ðŸ“Š'),
                React.createElement('div', null,
                  React.createElement('h1', { className: 'text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent' }, 'PredictScreen'),
                  React.createElement('p', { className: 'text-xs text-gray-400' }, 'Real-time Prediction Markets')
                )
              ),
              React.createElement('div', { className: 'flex gap-2' },
                React.createElement('button', {
                  onClick: fetchMarkets,
                  className: 'px-3 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg text-sm'
                }, 'ðŸ”„ Refresh'),
                walletConnected ? 
                  React.createElement('div', { className: 'px-3 py-2 bg-green-900/30 border border-green-700 rounded-lg text-sm' },
                    `${walletAddress.slice(0, 6)}...${walletAddress.slice(-4)}`
                  ) :
                  React.createElement('button', {
                    onClick: connectWallet,
                    className: 'px-3 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm'
                  }, 'ðŸ’° Connect Wallet')
              )
            ),

            error && React.createElement('div', { className: 'mb-3 p-3 bg-red-900/30 border border-red-700 rounded-lg flex justify-between items-center' },
              React.createElement('span', { className: 'text-sm text-red-300' }, error),
              React.createElement('button', { onClick: () => setError(null), className: 'text-red-400' }, 'âœ•')
            ),

            success && React.createElement('div', { className: 'mb-3 p-3 bg-green-900/30 border border-green-700 rounded-lg flex justify-between items-center' },
              React.createElement('span', { className: 'text-sm text-green-300' }, success),
              React.createElement('button', { onClick: () => setSuccess(null), className: 'text-green-400' }, 'âœ•')
            ),

            React.createElement('div', { className: 'flex gap-2 flex-wrap' },
              React.createElement('input', {
                type: 'text',
                placeholder: 'ðŸ” Search markets...',
                value: searchTerm,
                onChange: (e) => setSearchTerm(e.target.value),
                className: 'flex-1 min-w-[200px] px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-sm'
              }),
              ['all', 'Politics', 'Sports', 'Economy', 'Crypto', 'Other'].map(cat =>
                React.createElement('button', {
                  key: cat,
                  onClick: () => setFilter(cat),
                  className: `px-3 py-2 rounded-lg text-sm ${filter === cat ? 'bg-blue-600' : 'bg-gray-800 hover:bg-gray-700'}`
                }, cat.charAt(0).toUpperCase() + cat.slice(1))
              )
            )
          )
        ),

        // Markets
        React.createElement('div', { className: 'max-w-7xl mx-auto px-4 py-6' },
          loading ? 
            React.createElement('div', { className: 'flex flex-col items-center justify-center h-64 gap-4' },
              React.createElement('div', { className: 'w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin' }),
              React.createElement('p', { className: 'text-gray-400' }, 'Loading markets...')
            ) :
            React.createElement('div', { className: 'grid gap-4' },
              filteredMarkets.map(market =>
                React.createElement('div', {
                  key: market.id,
                  className: 'bg-gray-900 border border-gray-800 rounded-xl p-5 hover:border-gray-700'
                },
                  React.createElement('div', { className: 'flex gap-4' },
                    React.createElement('div', { className: 'flex-1' },
                      React.createElement('div', { className: 'flex gap-2 mb-2' },
                        React.createElement('span', { className: 'px-2 py-1 bg-gray-800 text-xs rounded' }, market.platform),
                        React.createElement('span', { className: 'px-2 py-1 bg-blue-900/30 text-blue-400 text-xs rounded' }, market.category)
                      ),
                      React.createElement('h3', { className: 'text-lg font-semibold mb-3' }, market.title),
                      React.createElement('div', { className: 'space-y-2' },
                        market.outcomes.map((outcome, idx) =>
                          React.createElement('div', { key: idx, className: 'flex items-center gap-3' },
                            React.createElement('div', { className: 'flex-1 bg-gray-800 rounded-full h-8 relative overflow-hidden' },
                              React.createElement('div', {
                                className: `absolute inset-y-0 left-0 ${idx === 0 ? 'bg-gradient-to-r from-green-600 to-green-500' : 'bg-gradient-to-r from-red-600 to-red-500'}`,
                                style: { width: `${outcome.prob}%` }
                              }),
                              React.createElement('div', { className: 'relative px-3 py-1 flex justify-between text-xs' },
                                React.createElement('span', { className: 'font-medium' }, outcome.name),
                                React.createElement('span', { className: 'font-bold' }, `${outcome.prob}%`)
                              )
                            )
                          )
                        )
                      )
                    ),
                    React.createElement('div', { className: 'flex flex-col gap-3 min-w-[200px]' },
                      React.createElement('div', { className: 'bg-gray-800/50 rounded-lg p-3' },
                        React.createElement('div', { className: 'text-gray-400 text-xs mb-1' }, 'ðŸ’° Total Volume'),
                        React.createElement('div', { className: 'text-lg font-bold' }, formatVolume(market.volume))
                      ),
                      React.createElement('div', { className: 'bg-gray-800/50 rounded-lg p-3' },
                        React.createElement('div', { className: 'text-gray-400 text-xs mb-1' }, 'ðŸ“ˆ 24h Volume'),
                        React.createElement('div', { className: 'text-lg font-bold' }, formatVolume(market.volume24h))
                      ),
                      React.createElement('a', {
                        href: market.url,
                        target: '_blank',
                        rel: 'noopener noreferrer',
                        className: 'px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-center text-sm font-medium'
                      }, 'ðŸš€ Trade Now')
                    )
                  )
                )
              ),
              filteredMarkets.length === 0 && 
                React.createElement('div', { className: 'text-center py-12 text-gray-500' }, 'No markets found')
            )
        ),

        // Footer
        React.createElement('div', { className: 'border-t border-gray-800 mt-12 py-6' },
          React.createElement('div', { className: 'max-w-7xl mx-auto px-4 text-center text-sm text-gray-500' },
            React.createElement('p', null, 'Live data from Polymarket & Kalshi â€¢ Updates every 30s'),
            React.createElement('p', { className: 'mt-2 text-xs' }, 'ðŸ”¥ Built for prediction market degens')
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('app'));
    root.render(React.createElement(PredictScreen));
  </script>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</body>
</html>